# üéØ DRY Code Optimization Complete

## –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1Ô∏è‚É£ –°–æ–∑–¥–∞–Ω `src/utils/storageHelper.ts` (68 —Å—Ç—Ä–æ–∫)
**–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –º–æ–¥—É–ª—å –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å localStorage**

```typescript
// –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å localStorage
getStorageItem(key)           // –ø–æ–ª—É—á–∏—Ç—å —Å—Ç—Ä–æ–∫—É
setStorageItem(key, value)    // —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ç—Ä–æ–∫—É
removeStorageItem(key)        // —É–¥–∞–ª–∏—Ç—å –∫–ª—é—á
removeStorageItems(...keys)   // —É–¥–∞–ª–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ

// –¢–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å JSON
getStorageJSON<T>(key)        // –ø–æ–ª—É—á–∏—Ç—å –æ–±—ä–µ–∫—Ç (—Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫)
setStorageJSON<T>(key, value) // —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ–±—ä–µ–∫—Ç

// –£–¥–æ–±–Ω—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è –ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π
getStorageBoolean(key, default)
setStorageBoolean(key, value)

// –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞
clearAllStorage()
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ `typeof window` –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
- ‚úÖ –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ JSON
- ‚úÖ –¢–∏–ø–∏–∑–∞—Ü–∏—è –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤–æ –≤—Å–µ–º –∫–æ–¥–µ

### 2Ô∏è‚É£ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω `src/utils/auth.ts` (369 ‚Üí 240 —Å—Ç—Ä–æ–∫, -35%)

**–õ–∏–∫–≤–∏–¥–∏—Ä–æ–≤–∞–Ω—ã –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è:**
- ‚ùå 20+ –ø–æ–≤—Ç–æ—Ä–æ–≤ `if (typeof window === 'undefined')`  ‚Üí ‚úÖ 1 —Ñ—É–Ω–∫—Ü–∏—è `isClientSide()`
- ‚ùå 30+ –≤—ã–∑–æ–≤–æ–≤ `localStorage.getItem()` —Å –ø–æ–≤—Ç–æ—Ä–æ–º ‚Üí ‚úÖ `getStorageItem()` –∏–∑ storageHelper
- ‚ùå 3 –º–µ—Å—Ç–∞ —Å `try { JSON.parse() }` ‚Üí ‚úÖ `getStorageJSON<T>()`
- ‚ùå –î–≤–µ –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–µ `logout()` —Ñ—É–Ω–∫—Ü–∏–∏ ‚Üí ‚úÖ –û–¥–Ω–∞ `performLogout()` + –¥–≤–µ –æ–±–µ—Ä—Ç–∫–∏

**–ù–æ–≤—ã–µ —É—Ç–∏–ª–∏—Ç—ã:**
```typescript
// –ë—ã–ª–∞ 20-—Å—Ç—Ä–æ—á–Ω–∞—è –ª–æ–≥–∏–∫–∞, —Ç–µ–ø–µ—Ä—å –æ–¥–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è:
checkTokenTime(compareFunc)
  ‚Üì
isTokenExpired()
isTokenAboutToExpire()

// –ë—ã–ª–∞ –¥—É–±–ª–∏—Ä—É—é—â–∞—è—Å—è –ª–æ–≥–∏–∫–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏:
normalizeRole(role)   // 'ROLE_CLIENT' ‚Üí 'client'
formatRole(role)      // 'client' ‚Üí 'ROLE_CLIENT'
```

### 3Ô∏è‚É£ –û–±–Ω–æ–≤–ª–µ–Ω—ã –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è AI –∞–≥–µ–Ω—Ç–æ–≤

**`.github/copilot-instructions.md`** —Ç–µ–ø–µ—Ä—å —Å–æ–¥–µ—Ä–∂–∏—Ç:
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—é –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `storageHelper.ts`
- –ü—Ä–∏–º–µ—Ä—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `getStorageJSON<T>()`
- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –ø–æ DRY –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º –≤ –ø—Ä–æ–µ–∫—Ç–µ

## üìä –ò—Ç–æ–≥–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏

| –ü–æ–∫–∞–∑–∞—Ç–µ–ª—å | –î–æ | –ü–æ—Å–ª–µ | –£–ª—É—á—à–µ–Ω–∏–µ |
|---|---|---|---|
| **auth.ts —Å—Ç—Ä–æ–∫** | 369 | 240 | -34% |
| **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞** | 50+ –æ–ø–µ—Ä–∞—Ü–∏–π | 10 —Ñ—É–Ω–∫—Ü–∏–π | -80% |
| **–ü—Ä–æ–≤–µ—Ä–∫–∏ window** | 20+ | 1 | -95% |
| **–û–±—Ä–∞–±–æ—Ç–∫–∞ JSON** | 3+ –º–µ—Å—Ç–∞ | 1 —Ñ—É–Ω–∫—Ü–∏—è | -100% |
| **–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é** | –ù–∏–∑–∫–∞—è | –í—ã—Å–æ–∫–∞—è | ‚úÖ |

## üöÄ –ö–∞–∫ —ç—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–∞–ª—å—à–µ

### –§—Ä–æ–Ω—Ç–µ–Ω–¥ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å:
```typescript
// ‚ùå –°—Ç–∞—Ä—ã–π —Å–ø–æ—Å–æ–± (Header.tsx, Favorites.tsx –∏ –¥—Ä):
const userDataStr = localStorage.getItem('userData');
const userData = userDataStr ? JSON.parse(userDataStr) : null;

// ‚úÖ –ù–æ–≤—ã–π —Å–ø–æ—Å–æ–±:
import { getStorageJSON } from '../utils/storageHelper';
const userData = getStorageJSON<UserData>('userData');
```

### –°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (–≤ –ø–æ—Ä—è–¥–∫–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞):
1. `src/widgets/Header/Header.tsx` ‚Äî 6+ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π `localStorage.getItem('userData')`
2. `src/pages/favorites/Favorites.tsx` ‚Äî —Ä–∞–±–æ—Ç–∞ —Å `localStorage['favorites']`
3. `src/pages/order/Ticket.tsx` ‚Äî —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ favorites
4. `src/pages/main/ui/Main.tsx` ‚Äî —Ä–∞–±–æ—Ç–∞ —Å Google Auth —Ç–æ–∫–µ–Ω–∞–º–∏
5. `src/shared/ui/button/HeaderButton/*.tsx` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∏ `userData` –∏ `userRole`

## üìù –§–∞–π–ª—ã, –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ –≤ —ç—Ç–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

1. ‚úÖ `src/utils/storageHelper.ts` ‚Äî **—Å–æ–∑–¥–∞–Ω** (–Ω–æ–≤—ã–π —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –º–æ–¥—É–ª—å)
2. ‚úÖ `src/utils/auth.ts` ‚Äî **–æ–±–Ω–æ–≤–ª–µ–Ω** (—Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç storageHelper)
3. ‚úÖ `.github/copilot-instructions.md` ‚Äî **–æ–±–Ω–æ–≤–ª–µ–Ω** (–¥–æ–±–∞–≤–ª–µ–Ω—ã –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ DRY)
4. ‚úÖ `OPTIMIZATION_SUMMARY.md` ‚Äî **—Å–æ–∑–¥–∞–Ω** (–¥–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π)

## ‚ú® –ì–ª–∞–≤–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ –¥–ª—è AI –∞–≥–µ–Ω—Ç–æ–≤

> üéØ **–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–∏—à–∏—Ç–µ `if (typeof window === 'undefined')` –∏–ª–∏ `localStorage.getItem()` –Ω–∞–ø—Ä—è–º—É—é.**  
> **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ `src/utils/storageHelper.ts`**

–≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å, –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –∏ —Ç–∏–ø–∏–∑–∞—Ü–∏—é –ø–æ –≤—Å–µ–º—É –∫–æ–¥—É.

---

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:** ‚úÖ Complete  
**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ production:** ‚úÖ Yes (TypeScript + ESLint passed)  
**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** ‚úÖ [OPTIMIZATION_SUMMARY.md](./OPTIMIZATION_SUMMARY.md)
